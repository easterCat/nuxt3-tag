import l from"./Icon.f96b4a01.js";import e from"./AreaTitle.aabfd2d0.js";import{u as a}from"./index.4fe012d4.js";import{u as s}from"./pinia.7ac5f2a7.js";import{u as t,a as n}from"./shop.8f25176c.js";import{_ as u}from"./document-copy.9ed563a4.js";import{_ as o}from"./delete.3a3a4f9c.js";import{_ as r}from"./opportunity.6a6909c9.js";import{e as m,a as i,f as d,$ as c,F as p,G as v,W as b,a2 as g,H as f,U as y,u as _,L as h,I as x,Y as k,Z as w,_ as j,i as V,a3 as C,a0 as S,a1 as E}from"./element-plus.3e7898c2.js";import{d as z}from"./dayjs.3bf4ac2a.js";import{_ as I}from"./entry.fcefc495.js";import"./lodash.93025024.js";import"./store.e5acb8cd.js";/* empty css                                                                  */import"./uuid.d56aad75.js";const U=l=>(S("data-v-ba805351"),l=l(),E(),l),$={class:"tranfer-con"},N={class:"button-con"},O=["value"],R=U((()=>b("div",{class:"flex justify-between w-full text-xs"},[b("span",null,"1张"),b("span",null,"2张"),b("span",null,"3张"),b("span",null,"4张"),b("span",null,"5张"),b("span",null,"6张"),b("span",null,"7张"),b("span",null,"8张"),b("span",null,"9张")],-1))),J={key:0,class:"g-image m-t-20"},Y=["src"],A={class:"title-side"},M={key:1,class:"history-con"},q={style:{"font-weight":"bold","margin-bottom":"4px"}},H={class:"history-button"},P=["onClick"],D=["onClick"],T=["onClick"],Z={key:2,class:"tags-con"},F=[U((()=>b("p",{class:"no-data"},"暂无记录",-1)))],G=I(m({__name:"generateImage",setup(m){const{NovalApi:S}=a(),{$store:E}=s(),{copy:I}=t(),{shop:U}=n(),G="prompt_history",L=i(""),W=i(""),B=i(1),K=i([]),Q=i(0),X=i([]),ll=i(!1),el=i([{label:"图片大小 512*768",value:"512*768"},{label:"图片大小 768*512",value:"768*512"},{label:"图片大小 512*512",value:"512*512"},{label:"图片大小 768*768",value:"768*768"},{label:"图片大小 768*1024",value:"768*1024"},{label:"图片大小 1024*768",value:"1024*768"}]),al=i("512*768"),sl=i([{label:"k_euler_ancestral",value:"k_euler_ancestral"},{label:"k_euler",value:"k_euler"},{label:"k_lms",value:"k_lms"},{label:"plms",value:"plms"},{label:"ddim",value:"ddim"}]),tl=i("k_euler_ancestral"),nl=i("lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry");d((()=>{cl(),ul(),W.value=sessionStorage.getItem("post_url")||""}));const ul=()=>{L.value=U.value,dl(L.value)},ol=()=>{pl(),K.value=[]},rl=()=>{L.value="",X.value=[]},ml=l=>{B.value=l.target.value||1},il=async()=>{if(ll.value)return;ll.value=!0;const l=al.value.split("*"),e=l[0],a=l[1];W.value.includes("/generate-stream")||(W.value=`${W.value}/generate-stream`);const s=await S.generate({height:a,n_samples:B.value,prompt:L.value,sampler:tl.value,scale:12,seed:2081400182,steps:28,uc:nl.value,ucPreset:0,width:e,postUrl:W.value});ll.value=!1;const t=new RegExp("(?<=data:)[A-Za-z0-9\\/+=]+","g"),n=`${s}`.match(t);X.value=null==n?void 0:n.map((l=>`data:image/png;base64,${l}`)),dl(L.value),sessionStorage.setItem("post_url",W.value)},dl=l=>{var e;let a=[];if(!l)return c.ElMessage({showClose:!0,message:"请输入prompt",type:"warning"});E.get(G)&&(a=null!=(e=JSON.parse(E.get(G)))?e:[]);if(!a.find((e=>e.prompt===l))){if(a&&a.length&&a.length>100)return c.ElMessage({showClose:!0,message:"数据超过100条",type:"warning"});a.includes(l)||a.unshift({prompt:l,time:z().format("YYYY年MM月DD日 HH时mm分ss秒")}),K.value=[...a],Q.value=K.value.length,E.set(G,JSON.stringify(K.value))}},cl=()=>{E.get(G)&&(K.value=JSON.parse(E.get(G)),Q.value=K.value.length)},pl=()=>{E.set(G,"")};return(a,s)=>{var t;const n=l,m=c.ElOption,i=c.ElSelect,d=c.ElCol,S=c.ElInput,z=c.ElRow,U=e,dl=r,cl=o,pl=u;return p(),v("div",$,[b("div",N,[b("button",{class:"btn btn-secondary btn-sm m-r-10",onClick:rl},[g(" 清空 "),f(n,{class:"m-l-6",name:"ant-design:delete-filled"})]),b("button",{class:"btn btn-sm btn-accent m-r-10",onClick:ul},[g(" 购物车导入 "),f(n,{class:"m-l-6",name:"clarity:shopping-cart-solid-badged"})]),b("button",{class:"btn btn-primary btn-sm m-r-10",onClick:il},[g(y(_(ll)?"图片生成中":"生成")+" ",1),_(ll)?(p(),h(n,{key:0,class:"m-l-6",name:"line-md:loading-twotone-loop"})):(p(),h(n,{key:1,class:"m-l-6",name:"entypo:brush"}))])]),f(z,{gutter:20},{default:x((()=>[f(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:x((()=>[f(i,{modelValue:_(al),"onUpdate:modelValue":s[0]||(s[0]=l=>V(al)?al.value=l:null),placeholder:"图片大小",size:"large",class:"w-full"},{default:x((()=>[(p(!0),v(k,null,w(_(el),(l=>(p(),h(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),f(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:x((()=>[f(i,{modelValue:_(tl),"onUpdate:modelValue":s[1]||(s[1]=l=>V(tl)?tl.value=l:null),placeholder:"采样器",size:"large",class:"w-full"},{default:x((()=>[(p(!0),v(k,null,w(_(sl),(l=>(p(),h(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),f(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:x((()=>[f(S,{modelValue:_(W),"onUpdate:modelValue":s[2]||(s[2]=l=>V(W)?W.value=l:null),placeholder:"请输入url,例如: https://cube-joan-released-philips.trycloudflare.com/generate-stream",clearable:"",size:"large"},null,8,["modelValue"])])),_:1}),f(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:x((()=>[f(S,{modelValue:_(L),"onUpdate:modelValue":s[3]||(s[3]=l=>V(L)?L.value=l:null),type:"textarea",placeholder:"请输入正面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),f(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:x((()=>[f(S,{modelValue:_(nl),"onUpdate:modelValue":s[4]||(s[4]=l=>V(nl)?nl.value=l:null),type:"textarea",placeholder:"请输入负面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),f(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:x((()=>[b("input",{type:"range",min:"1",max:"9",value:_(B),class:"range range-xs",step:"1",onChange:ml},null,40,O),R])),_:1})])),_:1}),_(X)?(p(),v("div",J,[b("ul",null,[(p(!0),v(k,null,w(_(X),((l,e)=>(p(),v("li",{key:e},[b("img",{src:l,alt:""},null,8,Y)])))),128))])])):j("",!0),f(U,{title:"历史记录"},{titleSide:x((()=>[b("span",A,"总数:"+y(_(Q))+"条",1)])),_:1}),_(K)&&(null==(t=_(K))?void 0:t.length)?(p(),v("div",M,[b("div",{class:"button-con"},[b("button",{class:"btn btn-accent btn-sm",onClick:ol},"清空历史")]),(p(!0),v(k,null,w(_(K),((l,e)=>(p(),v("div",{key:e,class:"history-item"},[b("p",q,[0===e?(p(),h(dl,{key:0,style:{color:"#67c23a","font-size":"12px"}})):j("",!0),b("span",null,y(null==l?void 0:l.time),1)]),b("p",null,y(null==l?void 0:l.prompt),1),b("div",H,[b("button",{class:"btn btn-sm btn-secondary m-r-10",onClick:l=>(l=>{var e;const a=null!=(e=JSON.parse(E.get(G)))?e:[];a.splice(l,1),K.value=[...a],Q.value=K.value.length,E.set(G,JSON.stringify(K.value))})(e)},[g(" 删除 "),C(a.$slots,"icon",{},(()=>[f(cl,{class:"m-l-6"})]),!0)],8,P),b("button",{class:"btn btn-sm btn-accent m-r-10",onClick:e=>_(I)(null==l?void 0:l.prompt)},[g(" 复制 "),C(a.$slots,"icon",{},(()=>[f(pl,{class:"m-l-6"})]),!0)],8,D),b("button",{class:"btn btn-sm btn-primary",onClick:e=>{return a=null==l?void 0:l.prompt,void(L.value=a);var a}},[g(" 选择 "),f(n,{class:"m-l-6",name:"icon-park-solid:full-selection"})],8,T)])])))),128))])):(p(),v("div",Z,F))])}}}),[["__scopeId","data-v-ba805351"]]);export{G as default};
