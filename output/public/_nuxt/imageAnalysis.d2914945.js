import e from"./Icon.f96b4a01.js";import a from"./AreaTitle.aabfd2d0.js";import{u as l}from"./index.4fe012d4.js";import{h as s,u as t}from"./pinia.7ac5f2a7.js";import{a as n,e as i}from"./shop.8f25176c.js";import{F as o,G as c,W as m,e as u,a as r,f as d,a2 as p,H as f,U as v,u as b,L as g,I as _,Y as y,Z as h,$ as k,i as j,a0 as C,a1 as x}from"./element-plus.3e7898c2.js";import{_ as A}from"./entry.fcefc495.js";import"./lodash.93025024.js";import"./dayjs.3bf4ac2a.js";import"./store.e5acb8cd.js";/* empty css                                                                  */import"./uuid.d56aad75.js";const w={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},I=[m("path",{fill:"currentColor",d:"M544 864V672h128L512 480L352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 0 1 512 192a239.872 239.872 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1)];const S={name:"ep-upload-filled",render:function(e,a){return o(),c("svg",w,I)}},E=e=>(C("data-v-22613ee2"),e=e(),x(),e),L={class:"tranfer-con"},z={class:"button-con"},P={class:"el-icon el-icon--upload"},D=E((()=>m("div",{class:"el-upload__text"},[p(" 拖动图片到当前区域 或 "),m("em",null,"点击上传")],-1))),H={class:"upload-image-list-item"},U=["onClick"],$=["src"],B={class:"m-l-6"},F=["checked"],R={class:"el-upload-list__item-actions"},T={class:"m-l-10"},G=E((()=>m("div",{class:"el-upload__tip"},"jpg/png文件格式",-1))),J=E((()=>m("span",{style:{"font-size":"12px"}},"(基于deepdanbooru解析)",-1))),K={class:"tags-con"},M={class:"badge m-l-8"},N=A(u({__name:"imageAnalysis",emits:["setPreview"],setup(u,{emit:C}){const x="prompt_history",{DanbooruApi:A}=l(),w=s(),{$store:I}=t(),{setShop:E}=n(),N=r(`${w.public.FLASK_BASE_API}/danbooru/upload`),O=r([]),V=r(0),W=r([]),Y=r(""),Z=r([]),q=r(!1);d((()=>{le()}));const Q=(e,a,l)=>{const{code:t,data:n}=e,i=s().public.IP_ADDRESS;if(200===t){const{file_name:e,file_path:a}=n,s=l.length;l[s-1].name=e,l[s-1].url=i+a,W.value=l}},X=async()=>{if(!Y.value)return i("请选择需要解析的图片");if(q.value)return;q.value=!0;const e=await A.analysisImage({name:Y.value});q.value=!1;const{code:a,data:l}=e;if(200===a){const{tags:e}=l;Z.value=e}},ee=()=>{Y.value="",W.value=[],Z.value=[]},ae=()=>{const e=Z.value.map((e=>e.key)).join(", ");E(e)},le=()=>{I.get(x)&&(O.value=JSON.parse(I.get(x)),V.value=O.value.length)};return(l,s)=>{const t=e,n=S,i=k.ElUpload,u=k.ElCol,r=k.ElRow,d=a;return o(),c("div",L,[m("div",z,[m("button",{class:"btn btn-secondary m-r-10 m-b-10",onClick:ee},[p(" 清空 "),f(t,{class:"m-l-6",name:"ant-design:delete-filled"})]),m("button",{class:"btn btn-accent m-r-10 m-b-10",onClick:ae},[p(" 导出购物车 "),f(t,{class:"m-l-6",name:"clarity:shopping-cart-solid-badged"})]),m("button",{class:"btn btn-primary m-r-10 m-b-10",onClick:X},[p(v(b(q)?"图片解析中":"解析图片")+" ",1),b(q)?(o(),g(t,{key:0,class:"m-l-6",name:"line-md:loading-twotone-loop"})):(o(),g(t,{key:1,class:"m-l-6",name:"mdi:comment-edit"}))])]),f(r,{gutter:20},{default:_((()=>[f(u,{xs:24,sm:24,md:24,lg:24,xl:24},{default:_((()=>[f(i,{"file-list":b(W),"onUpdate:file-list":s[0]||(s[0]=e=>j(W)?W.value=e:null),class:"upload-demo",drag:"",action:b(N),accept:"image/png, image/jpeg, image/jpg",multiple:"","list-type":"picture","on-success":Q},{file:_((({file:e})=>[m("div",H,[m("span",{onClick:a=>(e=>{Y.value=e.name})(e)},[m("img",{class:"el-upload-list__item-thumbnail",src:e.url,alt:""},null,8,$),m("span",B,v(e.name),1),m("input",{class:"checkbox m-l-10",type:"checkbox",checked:b(Y)===e.name},null,8,F)],8,U),m("span",R,[m("span",null,[f(t,{name:"material-symbols:image",size:"28",onClick:a=>{C("setPreview",e.url)}},null,8,["onClick"])]),m("span",T,[f(t,{name:"ic:baseline-delete",size:"28",onClick:a=>(e=>{console.log(e);const a=W.value.findIndex((a=>a.name===e.name));a>=0&&W.value.splice(a,1)})(e)},null,8,["onClick"])])])])])),tip:_((()=>[G])),default:_((()=>[m("i",P,[f(n)]),D])),_:1},8,["file-list","action"])])),_:1})])),_:1}),f(d,{title:"解析标签 "},{titleSide:_((()=>[J])),_:1}),m("div",K,[(o(!0),c(y,null,h(b(Z),((e,a)=>{var l;return o(),c("button",{key:a,class:"btn btn-sm btn-secondary m-r-10 m-b-10"},[m("span",null,v(null==(l=e.key)?void 0:l.toLowerCase()),1),m("div",M,v(e.value),1)])})),128))])])}}}),[["__scopeId","data-v-22613ee2"]]);export{N as default};
