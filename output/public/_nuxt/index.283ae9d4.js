import{_ as e}from"./FixMenu.vue_vue_type_style_index_0_scoped_8a5ecf18_lang.9c1025d6.js";import{u as a,B as l}from"./pinia.7ac5f2a7.js";import{F as n,G as t,W as o,e as i,r as s,w as r,a as d,f as u,b as c,a9 as m,Y as v,Z as p,V as g,X as h,H as f,I as _,a4 as y,_ as b,U as w,T as x,u as C,ab as L,x as j,a0 as I,a1 as k,q as A}from"./element-plus.3e7898c2.js";import{l as M}from"./lodash.93025024.js";import"./AppHeader.41b86523.js";import{_ as H}from"./entry.fcefc495.js";import"./dayjs.3bf4ac2a.js";import"./plus.bb77e419.js";import"./shop.8f25176c.js";import"./vuedraggable.5801950c.js";import"./sortablejs.c8011fea.js";import"./uuid.d56aad75.js";import"./index.4fe012d4.js";/* empty css                                                                  *//* empty css                                                                  */import"./Icon.f96b4a01.js";import"./store.e5acb8cd.js";const z={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},$=[o("path",{fill:"currentColor",d:"M176 416a112 112 0 1 0 0 224a112 112 0 0 0 0-224m0 64a48 48 0 1 1 0 96a48 48 0 0 1 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96z"},null,-1)];const E={name:"ep-more",render:function(e,a){return n(),t("svg",z,$)}},N={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},B=[o("path",{fill:"currentColor",d:"m512 747.84l228.16 119.936a6.4 6.4 0 0 0 9.28-6.72l-43.52-254.08l184.512-179.904a6.4 6.4 0 0 0-3.52-10.88l-255.104-37.12L517.76 147.904a6.4 6.4 0 0 0-11.52 0L392.192 379.072l-255.104 37.12a6.4 6.4 0 0 0-3.52 10.88L318.08 606.976l-43.584 254.08a6.4 6.4 0 0 0 9.28 6.72L512 747.84zM313.6 924.48a70.4 70.4 0 0 1-102.144-74.24l37.888-220.928L88.96 472.96A70.4 70.4 0 0 1 128 352.896l221.76-32.256l99.2-200.96a70.4 70.4 0 0 1 126.208 0l99.2 200.96l221.824 32.256a70.4 70.4 0 0 1 39.04 120.064L774.72 629.376l37.888 220.928a70.4 70.4 0 0 1-102.144 74.24L512 820.096l-198.4 104.32z"},null,-1)];const S={name:"ep-star",render:function(e,a){return n(),t("svg",N,B)}},T={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},q=[o("path",{fill:"currentColor",d:"m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"},null,-1)];const F={name:"ep-search",render:function(e,a){return n(),t("svg",T,q)}},W=e=>(I("data-v-f76fa079"),e=e(),k(),e),U={class:"water-fall"},D={class:"image-con"},G={class:"image-list"},O=["onMouseenter"],R=["date-src","alt"],V={key:0,class:"item-wrapper"},X={class:"icon-con"},Y={key:0},Z={class:"text-con"},J={class:"spinner"},K=[W((()=>o("div",{class:"dot1"},null,-1))),W((()=>o("div",{class:"dot2"},null,-1)))],P=H(i({__name:"index",props:["datas","flur","loading","searchText"],emits:["load","preview","favorite"],setup(i,{emit:I}){const k=i,{$store:H}=a(),z=l(),$=s({images:[],imagesLen:0,beginIndex:0,loadedCount:0,colsHeightArr:[],columnNumber:5});r((()=>k.datas),(e=>{console.log("val :>> ",e),"pc-home"===z.name&&(e&&e.length>0?(e.length<=50&&($.beginIndex=0,$.loadedCount=0),$.images=e,$.imagesLen=e.length,ie()):($.images=[],$.imagesLen=0,$.beginIndex=0,$.loadedCount=0,$.colsHeightArr=[],Q.value=1,ee.value=50))}));const N=d([]),B=d(0),T=d(0),q=d(null),W=d(window.document.body),P=d(null),Q=d(1),ee=d(50),ae=d(""),le=d([]),ne=()=>{P.value=null},te=()=>{let e,a,l;0===$.beginIndex&&($.colsHeightArr=[]);for(let n=$.beginIndex;n<$.imagesLen;++n){const t=$.images[n];if(!t)return;if(l=t._height||0,n<$.columnNumber)$.colsHeightArr.push(l),e=0,a=n*B.value+n%$.columnNumber;else{const n=Math.min.apply(null,$.colsHeightArr),t=$.colsHeightArr.indexOf(n);e=n,a=t*B.value,$.colsHeightArr[t]+=l}t._top=e,t._left=a}},oe=()=>{console.log("预加载完毕 :>> "),te(),le.value=$.images,j((()=>{(()=>{q.value&&(q.value.style.height=`${Math.max.apply(null,$.colsHeightArr)+340}px`);const e=A(N.value);if(e){for(let a=$.beginIndex;a<$.imagesLen;++a){const l=e[a];if(!l)return;const n=l.children[0].children[0];n.src=n.getAttribute("date-src"),n.style.transition="all 0.5s ease-in-out",n.onload=()=>{n.style.opacity=1,n.style.transform="scale(1)"}}$.beginIndex=e.length}})()}))},ie=()=>{T.value=document.body.clientHeight,$.images.forEach(((e,a)=>{if(!(a<$.loadedCount))if(e.minify_preview){const a=new Image;a.src=e.minify_preview,a.onload=a.onerror=l=>{e._width=B.value,e._height="load"===l.type?Math.round(B.value*(a.height/a.width)):a.width,"error"===l.type&&(e._error=!0),$.loadedCount=$.loadedCount+1,$.imagesLen===$.loadedCount&&oe()}}else e._width=B.value,e._height=B.value,$.loadedCount=$.loadedCount+1,$.imagesLen===$.loadedCount&&oe()}))},se=()=>{console.log("页面宽高变化预加载完毕 :>> "),te(),le.value=$.images,j((()=>{(()=>{q.value&&(q.value.style.height=`${Math.max.apply(null,$.colsHeightArr)+340}px`);const e=A(N.value);e&&($.beginIndex=e.length)})()}))},re=()=>{const e=document.body.clientWidth;$.columnNumber=e>3500?10:e<3500&&e>2500?8:e<2500&&e>2e3?7:e<2e3&&e>1700?6:e<1700&&e>1380?5:e<1380&&e>1160?4:e<1160&&e>850?3:e<850&&e>600?2:1,B.value=Math.round((document.body.clientWidth-30)/$.columnNumber)},de=M.debounce((()=>{if(k.loading)return;const e=Math.min.apply(null,$.colsHeightArr);W.value.scrollTop+T.value>e-20&&(console.log("触底"),Q.value=Q.value+1,I("load",{pageIndex:Q.value,pageSize:ee.value}))}),1500),ue=M.debounce((()=>{re(),$.loadedCount=0,$.beginIndex=0,$.images.forEach((e=>{e.minify_preview?(e._width=B.value,e._height=Math.round(B.value*(e._height/e._width)),$.loadedCount=$.loadedCount+1,$.imagesLen===$.loadedCount&&se()):(e._width=B.value,e._height=B.value,$.loadedCount=$.loadedCount+1,$.imagesLen===$.loadedCount&&se())}))}),800);return u((()=>{var e;ae.value=H.get("ip"),$.images=k.datas?k.datas:[],$.imagesLen=null==(e=k.datas)?void 0:e.length,re(),ie(),W.value=document.querySelector(".home-page"),W.value.addEventListener("scroll",de),window.addEventListener("resize",ue)})),c((()=>{W.value.removeEventListener("scroll",de),window.removeEventListener("resize",ue)})),(a,l)=>{const s=F,r=S,d=E,u=e,c=m("animate-css");return n(),t("div",U,[o("div",{ref_key:"wrapper",ref:q,class:"wrapper"},[o("div",D,[o("ul",G,[(n(!0),t(v,null,p(C($).images,((e,a)=>(n(),t("li",{key:a,ref_for:!0,ref_key:"domRefs",ref:N,class:"image-item",style:g(`width:${B.value}px;height:${e._height}px;top:${e._top}px;left:${e._left}px;`)},[o("div",{class:"image-con",onMouseenter:e=>{return l=a,void(P.value=l);var l},onMouseleave:ne},[o("img",{"date-src":null==e?void 0:e.minify_preview,alt:null==e?void 0:e.prompt,class:h({"image-blur":!!i.flur})},null,10,R),f(x,{name:"fade-q"},{default:_((()=>[P.value===a?(n(),t("div",V,[f(u,null,{default:_((()=>{var l;return[y((n(),t("div",X,[P.value===a?(n(),t("span",Y,[f(s)])):b("",!0),o("span",null,[f(r,{class:h({liked:null==(l=null==e?void 0:e.like_address)?void 0:l.includes(ae.value)}),onClick:l=>(async(e,a)=>{I("favorite",e);const l=le.value[a].like_address,n=le.value[a].like;le.value[a].like_address=l?`${l},${ae.value}`:`${ae.value}`,le.value[a].like=n+1})(null==e?void 0:e.id,a)},null,8,["class","onClick"]),f(d,{onClick:a=>{return l=e,void I("preview",{...l});var l}},null,8,["onClick"])])])),[[c,{direction:"modifySlideInDown"}]])]})),_:2},1024),f(u,null,{default:_((()=>[y((n(),t("div",Z,[o("p",null,w(null==e?void 0:e.name),1),o("p",null,w(null==e?void 0:e.prompt),1)])),[[c,{direction:"modifySlideInUp"}]])])),_:2},1024)])):b("",!0)])),_:2},1024)],40,O)],4)))),128))])])],512),y(o("div",J,K,512),[[L,i.loading]])])}}}),[["__scopeId","data-v-f76fa079"]]);export{P as default};
